<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.ontio.mapper.Orc20Mapper">


  <resultMap id="BaseResultMap" type="com.github.ontio.model.dao.Orc20">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="contract_hash" jdbcType="VARCHAR" property="contractHash" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="total_supply" jdbcType="DECIMAL" property="totalSupply" />
    <result column="symbol" jdbcType="VARCHAR" property="symbol" />
    <result column="decimals" jdbcType="INTEGER" property="decimals" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="audit_flag" jdbcType="BIT" property="auditFlag" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="vm_category" jdbcType="VARCHAR" property="vmCategory"/>
  </resultMap>

  <cache type="com.github.ontio.config.RedisCache">
    <property name="eviction" value="LRU" />
    <property name="size" value="1024" />
    <property name="readOnly" value="false" />
  </cache>


  <select id="selectOrc20Tokens" resultType="com.github.ontio.model.dto.Orc20DetailDto">
    SELECT
      a.contract_hash AS contractHash,
      a.name AS NAME,
      a.creator AS creator,
      a.description AS description,
      a.logo AS logo,
      a.create_time AS createTime,
      a.update_time AS updateTime,
      a.contact_info AS contactInfo,
      IFNULL(c.holder_count,a.address_count) as addressCount,
      a.tx_count AS txCount,
      b.total_supply AS totalSupply,
      b.decimals AS decimals,
      b.symbol AS symbol,
      b.vm_category AS vmCategory
    FROM tbl_contract a
    INNER JOIN tbl_orc20 b ON a.contract_hash = b.contract_hash
    LEFT JOIN tbl_holder_contract c ON a.contract_hash = c.contract_hash
    WHERE a.audit_flag = 1
      AND b.audit_flag = 1
    <trim prefix="order by" prefixOverrides=",">
      <if test="ascending != null">
        <foreach collection="ascending" item="sort">
          , a.${sort}
        </foreach>
      </if>
      <if test="descending != null">
        <foreach collection="descending" item="sort">
          , a.${sort} desc
        </foreach>
      </if>
    </trim>
</select>


  <select id="selectOrc20TokenDetail" resultType="com.github.ontio.model.dto.Orc20DetailDto">
    SELECT
      a.contract_hash AS contractHash,
      a.name AS NAME,
      a.abi AS abi,
      a.code AS CODE,
      a.source_code AS sourceCode,
      a.category AS category,
      a.creator AS creator,
      a.description AS description,
      a.logo AS logo,
      a.create_time AS createTime,
      a.update_time AS updateTime,
      a.contact_info AS contactInfo,
      a.type AS TYPE,
      a.ong_sum AS ongSum,
      a.ont_sum AS ontSum,
      a.token_sum AS tokenSum,
      a.address_count AS addressCount,
      a.tx_count AS txCount,
      b.total_supply AS totalSupply,
      b.decimals AS decimals,
      b.symbol AS symbol,
      b.vm_category AS vmCategory
    FROM tbl_contract a, tbl_orc20 b
    WHERE a.contract_hash = b.contract_hash
      AND a.audit_flag = 1
      AND b.audit_flag = 1
      AND b.contract_hash = #{contractHash}
  </select>



</mapper>