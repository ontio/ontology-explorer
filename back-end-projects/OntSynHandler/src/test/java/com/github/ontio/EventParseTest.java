package com.github.ontio;

import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.github.ontio.common.Helper;
import org.junit.Test;

/**
 * @author zhouq
 * @version 1.0
 * @date 2019/3/28
 */
public class EventParseTest {

    @Test
    public void parseEvent() {
        try {

            String contractAddress2 =Helper.reverse("ecd1fcc4ed4d2f14508afa9418ded28eba138c60");

            System.out.println("contractAddress:"+contractAddress2);

            String nodeRestfulUrl = "http://dappnode1.ont.io:20334";
            OntSdk ontSdk = OntSdk.getInstance();
            ontSdk.setRestful(nodeRestfulUrl);

            String txHash = "b2a73f5b42aefd8ac03baec2c97ba95285f0ff681f1bc679668b80fa48c4cf39";
            JSONObject eventObj = (JSONObject) ontSdk.getConnect().getSmartCodeEvent(txHash);
            System.out.println("eventObj:"+eventObj.toJSONString());

            JSONArray notifyList = eventObj.getJSONArray("Notify");
            JSONObject notifyObj = (JSONObject) notifyList.get(0);

            String contractAddress = notifyObj.getString("ContractAddress");
            System.out.println("contractAddress:"+contractAddress);

            JSONArray stateArray = (JSONArray) notifyObj.get("States");


            String action = new String(Helper.hexToBytes((String) stateArray.get(0)));
            System.out.println("action:" + action);


/*            String fromAddress = Address.parse(Helper.reverse((String) stateArray.get(1))).toBase58();
            System.out.println("address:" + fromAddress);

            String toAddress = Address.parse(Helper.reverse("27fa4812f657a9f320003d651a6c3bae7f908226")).toBase58();
            System.out.println("toAddress:" + toAddress);

*//*            BigDecimal amount = new BigDecimal(Helper.BigIntFromNeoBytes(Helper.hexToBytes("01")).longValue());
            System.out.println("amount:"+amount);*//*

            BigDecimal oepAmount = new BigDecimal(Helper.BigIntFromNeoBytes(Helper.hexToBytes("300731e700")).longValue());
            System.out.println("oepAmount:" + oepAmount);*/
        }catch (Exception e){
            e.printStackTrace();
        }
    }


    @Test
    public void test02(){

        String calledContractHash = "";
        String code = "0125c56b6a00527ac46a51527ac46a00c30c726f6c6c696e675f646963659c6436006a51c300c36a51c351c36a51c352c36a51c353c36a51c354c3547951795672755172755379527955727552727565ad126c7566616a00c3076d6967726174659c6414006a51c300c36a51c351c37c659d066c7566616a00c30877697468647261779c640e006a51c300c36510096c7566616a00c30d77697468647261775f646963659c640e006a51c300c3653b086c7566616a00c30d77697468647261775f736f6e749c640e006a51c300c36566076c7566616a00c30969735f7061757365649c64090065d9056c7566616a00c3097365745f70617573659c640e006a51c300c365f6046c7566616a00c30d72616e6b696e675f6772616e749c640e006a51c300c365990f6c7566616a00c306706c656467659c6414006a51c300c36a51c351c37c65c90d6c7566616a00c30e706c656467655f72656c696576659c616414006a51c300c36a51c351c37c65890b6c7566616a00c30b706c656467655f647261779c640e006a51c300c365cb096c7566616a00c30b626f6e75735f6772616e749c6414006a51c300c36a51c351c37c659a086c7566616a00c3095f7472616e736665729c6445006a51c300c36a51c351c36a51c352c36a51c353c36a51c354c36a51c355c355795179577275517275547952795672755272755379537955727553727565c4176c7566616a00c3155f7472616e736665725f66726f6d5f62616e6b65729c6436006a51c300c36a51c351c36a51c352c36a51c353c36a51c354c354795179567275517275537952795572755272756577156c7566616a00c30f5f7472616e736665725f62617463689c640e006a51c300c365b3146c7566616a00c31b5f7472616e736665725f62617463685f66726f6d5f62616e6b65729c640e006a51c300c365f2136c7566616538036c7566006c75660135c56b6a00527ac45a6a51527ac45b6a52527ac45c6a53527ac45d6a54527ac45e6a55527ac45f6a56527ac4006a57527ac4006a58527ac46a00c3c06a59527ac46a00c3c051946a5a527ac461616a58c36a59c39f6408026a00c36a58c36a58c351937b6b7c766b946c6c52727f6a5b527ac4606a5ac37c65ee016a5c527ac46a5bc301309c6414006a57c3006a5cc395936a57527ac462ae01616a5bc301319c6414006a57c3516a5cc395936a57527ac4629301616a5bc301329c6414006a57c3526a5cc395936a57527ac4627801616a5bc301339c6414006a57c3536a5cc395936a57527ac4625d01616a5bc301349c6414006a57c3546a5cc395936a57527ac4624201616a5bc301359c6414006a57c3556a5cc395936a57527ac4622701616a5bc301369c6414006a57c3566a5cc395936a57527ac4620c01616a5bc301379c6414006a57c3576a5cc395936a57527ac462f100616a5bc301389c6414006a57c3586a5cc395936a57527ac462d600616a5bc301399c6414006a57c3596a5cc395936a57527ac462bb00616a5bc301619c6416006a57c36a51c36a5cc395936a57527ac4629e00616a5bc301629c6416006a57c36a52c36a5cc395936a57527ac4628100616a5bc301639c6416006a57c36a53c36a5cc395936a57527ac4626400616a5bc301649c6416006a57c36a54c36a5cc395936a57527ac4624700616a5bc301659c6416006a57c36a55c36a5cc395936a57527ac4622a00616a5bc301669c6416006a57c36a56c36a5cc395936a57527ac4620d00614f6a57527ac4621d00616a58c351936a58527ac46a5ac351946a5a527ac462f3fd6161616a57c36c75665ac56b6a00527ac46a51527ac4516a52527ac4006a53527ac461616a53c36a51c39f641c006a00c36a52c3956a52527ac46a53c351936a53527ac462dfff6161616a52c36c75665bc56b6a00527ac4006a51527ac4006a52527ac46a00c3c06a53527ac461616a52c36a53c39f6438006a00c36a52c36a52c351937b6b7c766b946c6c52727f6a54527ac46a51c36a54c390936a51527ac46a52c351936a52527ac462c3ff6161616a51c36c756655c56b6a00527ac46a00c3630900650b006c756661006c756653c56b09f4f4f3f3f2f2f1f100f0006c75665ac56b6a00527ac42241474d344e6f47763231617733644b78614144315832376d574e4e32754e5658473375140646aee1037c9e4b034c70cb19ae2289191f3ab16a51527ac4681953797374656d2e53746f726167652e476574436f6e74657874616a52527ac40570617573656a53527ac46a51c365d418756a52c36a53c36a00c35272681253797374656d2e53746f726167652e50757461097365745f70617573656a00c352c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c756655c56b681953797374656d2e53746f726167652e476574436f6e74657874616a00527ac40570617573656a51527ac46a00c36a51c37c681253797374656d2e53746f726167652e476574616c75665dc56b6a00527ac46a51527ac42241474d344e6f47763231617733644b78614144315832376d574e4e32754e5658473375140646aee1037c9e4b034c70cb19ae2289191f3ab16a52527ac46a52c365e717750d4449434520436f6e74726163746a53527ac4076f6e742e6265746a54527ac40e6f6e74626574403136332e636f6d6a55527ac40d4449434520436f6e74726163746a56527ac46a00c30000006a53c36a51c36a54c36a55c36a56c3587951795a727551727557795279597275527275567953795872755372755579547957727554727568194f6e746f6c6f67792e436f6e74726163742e4d69677261746561146d696772617465207375636365737366756c6c7951c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c75665cc56b6a00527ac42241474d344e6f47763231617733644b78614144315832376d574e4e32754e5658473375140646aee1037c9e4b034c70cb19ae2289191f3ab16a51527ac4154f4e54444943455f57495448445241575f534f4e546a52527ac46a51c365aa16756a00c351a2652dfd756a51c36a00c37c65c4136a53527ac46a53c3630700652dfd75616a52c36a51c36a00c353c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c75665cc56b6a00527ac42241474d344e6f47763231617733644b78614144315832376d574e4e32754e5658473375140646aee1037c9e4b034c70cb19ae2289191f3ab16a51527ac4154f4e54444943455f57495448445241575f444943456a52527ac46a51c365f615756a00c351a26579fc756a51c36a00c37c65f7116a53527ac46a53c36307006579fc75616a52c36a51c36a00c353c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c75665cc56b6a00527ac42241474d344e6f47763231617733644b78614144315832376d574e4e32754e5658473375140646aee1037c9e4b034c70cb19ae2289191f3ab16a51527ac4104f4e54444943455f57495448445241576a52527ac46a51c3654715756a00c351a265cafb756a51c36a00c37c657a136a53527ac46a53c363070065cafb75616a52c36a51c36a00c353c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c75665fc56b6a00527ac46a51527ac42241474d344e6f47763231617733644b78614144315832376d574e4e32754e5658473375140646aee1037c9e4b034c70cb19ae2289191f3ab16a52527ac422415963475a5a55546f396757674a337047537134477479395734615767314d7334757514b8a91b694990a037de3e8cdcbd7a691e70561b2d6a53527ac46a52c3656b14756a00c300a265eefa756a51c300a265e5fa756a53c36a00c37c657c1163070065edfa75616a53c36a51c37c65831263070065dbfa756119626f6e75735f706f6f6c5f61776172645f7472616e736665726a52c36a53c36a00c36a51c355c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c75660112c56b6a00527ac42241474d344e6f47763231617733644b78614144315832376d574e4e32754e5658473375140646aee1037c9e4b034c70cb19ae2289191f3ab16a51527ac4681953797374656d2e53746f726167652e476574436f6e74657874616a52527ac46a00c3658013756a52c307756e7061776e5f6a00c37e7c681253797374656d2e53746f726167652e476574616a53527ac46a53c363070065f1f975616a53c300a265cef9756a52c30a7061776e5f74696d655f6a00c37e7c681253797374656d2e53746f726167652e476574616a54527ac4681653797374656d2e52756e74696d652e47657454696d65616a54c30380510193a0657bf9756a00c36a53c37c65f90e6307006583f975616a52c30a7061776e5f74696d655f6a00c37e005272681253797374656d2e53746f726167652e507574616a52c307756e7061776e5f6a00c37e005272681253797374656d2e53746f726167652e507574610d7061776e5f7472616e736665726a51c36a00c304444943456a53c355c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c7566011dc56b6a00527ac46a51527ac4681953797374656d2e53746f726167652e476574436f6e74657874616a52527ac4659af9640700006c7566616a00c3650f12756a51c300a26592f8756a52c307756e7061776e5f6a00c37e7c681253797374656d2e53746f726167652e476574616a53527ac46a53c36407006577f875616a52c3057061776e5f6a00c37e7c681253797374656d2e53746f726167652e476574616a54527ac46a54c36307006544f875616a54c36a51c3a26307006535f875616a52c3057061776e5f6a00c37e6a54c36a51c3945272681253797374656d2e53746f726167652e507574616a52c30a7061776e5f74696d655f6a00c37e681653797374656d2e52756e74696d652e47657454696d65615272681253797374656d2e53746f726167652e507574616a52c307756e7061776e5f6a00c37e6a51c35272681253797374656d2e53746f726167652e507574616a52c3047061776e7c681253797374656d2e53746f726167652e476574616a55527ac46a55c36307006571f775616a55c36a51c3a26307006562f775616a52c3047061776e6a55c36a51c3945272681253797374656d2e53746f726167652e507574616a52c3057061776e5f6a00c37e7c681253797374656d2e53746f726167652e476574616a54527ac406756e7061776e6a00c304444943456a54c36a51c355c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c75660116c56b6a00527ac46a51527ac4681953797374656d2e53746f726167652e476574436f6e74657874616a52527ac46583f7640700006c7566616a00c365f80f756a51c300a2657bf6756a00c36a51c37c65820c6307006583f675616a52c3057061776e5f6a00c37e7c681253797374656d2e53746f726167652e476574616a53527ac46a53c36431006a52c3057061776e5f6a00c37e6a53c36a51c3935272681253797374656d2e53746f726167652e50757461622b00616a52c3057061776e5f6a00c37e6a51c35272681253797374656d2e53746f726167652e50757461616a52c3047061776e7c681253797374656d2e53746f726167652e476574616a54527ac46a54c3642c006a52c3047061776e6a54c36a51c3935272681253797374656d2e53746f726167652e50757461622600616a52c3047061776e6a51c35272681253797374656d2e53746f726167652e50757461616a52c3057061776e5f6a00c37e7c681253797374656d2e53746f726167652e476574616a53527ac4047061776e6a00c304444943456a53c30055c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c75660116c56b6a00527ac42241474d344e6f47763231617733644b78614144315832376d574e4e32754e5658473375140646aee1037c9e4b034c70cb19ae2289191f3ab16a51527ac413434f4e53545f52414e4b494e475f4752414e546a52527ac46a51c365220e756a00c3c0529e6433002e5f7472616e736665725f6d756c74695f736f6e745f66726f6d5f62616e6b657220706172616d73206572726f722ef0616a00c300c36a53527ac4006a56527ac46a53c3c06a57527ac4616a56c36a57c39f6491006a53c36a56c3c36a54527ac46a56c351936a56527ac46a54c3c0539e6433002e5f7472616e736665725f6d756c74695f736f6e745f66726f6d5f62616e6b657220706172616d73206572726f722ef0616a54c351c36a54c352c37c65930a6397ff285f7472616e736665725f6d756c74695f736f6e745f66726f6d5f62616e6b6572206661696c65642ef0626aff6161616a00c351c36a55527ac4006a58527ac46a55c3c06a59527ac4616a58c36a59c39f648f006a55c36a58c3c36a54527ac46a58c351936a58527ac46a54c3c0539e6432002d5f7472616e736665725f6d756c74695f6f6e675f66726f6d5f62616e6b657220706172616d73206572726f722ef0616a54c351c36a54c352c37c65f80a6398ff275f7472616e736665725f6d756c74695f6f6e675f66726f6d5f62616e6b6572206661696c65642ef0626cff6161616a52c31272616e6b696e67206772616e74207375636352c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c75660143c56b6a00527ac46a51527ac46a52527ac46a53527ac46a54527ac422414b7a56346655416f364a6b3935724d6558444c413752556742795a4452366f657775142e430f1b20e87347140bec99a43db1453eabfd516a55527ac4224157383150774d636d7a7a436b6e47726e317977516e6b357335334c58465666366a75149d608c788ad6dd17932ea024a15bbbe41acb3c416a56527ac40561383839626a57527ac4682d53797374656d2e457865637574696f6e456e67696e652e476574457865637574696e6753637269707448617368616a58527ac402d9036a59527ac40340420f6a5a527ac402e8036a5b527ac4035042486a5c527ac465c8f2640700006c7566616a00c3653d0b756a51c352a265c0f1756a51c30160a165b6f1756a52c30400ca9a3ba265a9f1756a52c3050088526a74a1659bf1756a54c351a26592f1756a54c352a16589f1756a52c36a5d527ac46a54c3519c641f006a00c36a5dc37c65020a6a5e527ac46a5ec36336006579f175622f00616a54c3529c6421006a00c36a5dc35a967c6572086a5e527ac46a5ec3630f006552f17562080061654af1756168244f6e746f6c6f67792e52756e74696d652e47657443757272656e74426c6f636b4861736861659ef06a5f527ac46a5fc3681653797374656d2e52756e74696d652e47657454696d6561013a93936a5f527ac46a5fc36a00c3656bf06a53c36565f0936a58c3655ef093936a5f527ac46a5fc36a57c365a0ed015895936a5f527ac46a5fc301649751936a60527ac4006a0111527ac46a51c36a60c3a06487006a5ac30164956a51c35194966a59c3956a5ac3966a0112527ac46a5dc36a0112c3956a5bc3966a0111527ac46a54c3519c6420006a00c36a0111c37c650a086a5e527ac46a5ec3633900655af075623200616a54c3529c642d006a0111c35a966a0111527ac46a00c36a0111c37c65bf066a5e527ac46a5ec3630b006528f0756162030061006a0113527ac46a54c3519c640f006a52c36a0113527ac4621700616a54c3529c640e006a52c353956a0113527ac4616a00c36a0113c37c65570575006a0114527ac46a53c3c001149c641e006a0113c35a966a0114527ac46a53c36a0114c37c652e057562180061006a53527ac46a56c36a0113c35a967c65160575616a55c36a0113c35a965b950119950164967c65ff04756a5cc36a00c36a60c36a51c36a5dc36a0113c36a53c36a0114c36a0111c359c176c9681553797374656d2e52756e74696d652e4e6f7469667961516c75665ac56b6a00527ac4006a53527ac46a00c3c06a54527ac4616a53c36a54c39f646c006a00c36a53c3c36a51527ac46a53c351936a53527ac46a51c3c0559e640700650cef75616a51c300c36a51c351c36a51c352c36a51c353c36a51c354c3547951795672755172755379527955727552727565c0006a52527ac46a52c301019e6496ff65c9ee75628fff616161516c75665ac56b6a00527ac4006a53527ac46a00c3c06a54527ac4616a53c36a54c39f647b006a00c36a53c3c36a51527ac46a53c351936a53527ac46a51c3c0569e640700657aee75616a51c300c36a51c351c36a51c352c36a51c353c36a51c354c36a51c355c3557951795772755172755479527956727552727553795379557275537275651b026a52527ac46a52c301019e6487ff6528ee756280ff616161516c75660118c56b6a00527ac46a51527ac46a52527ac46a53527ac46a54527ac41400000000000000000000000000000000000000026a55527ac42241474d344e6f47763231617733644b78614144315832376d574e4e32754e5658473375140646aee1037c9e4b034c70cb19ae2289191f3ab16a56527ac4682d53797374656d2e457865637574696f6e456e67696e652e476574457865637574696e6753637269707448617368616a57527ac401016a58527ac46a56c365c106756a52c3034f4e479c646d006a57c36a00c36a51c353c66b6a52527ac46a51527ac46a00527ac46c6a59527ac4006a55c3087472616e736665726a59c351c176c9537951795572755172755279527954727552727568164f6e746f6c6f67792e4e61746976652e496e766f6b65616a58527ac4628a00616a52c304534f4e549c643700087472616e736665726a57c36a00c36a51c353c176c97c677dd2f7853d8ce3f9e9226c4a21ee09f9eb1ea0966a58527ac4624900616a52c304444943459c643700087472616e736665726a57c36a00c36a51c353c176c97c67bc28b0f6541650b30d36144d077e5e77a46eb29b6a58527ac462080061656aec75616a53c36a54c36a57c36a00c36a52c36a51c36a58c357c176c9681553797374656d2e52756e74696d652e4e6f74696679616a58c301019c640700516c756661006c7566006c75660117c56b6a00527ac46a51527ac46a52527ac46a53527ac46a54527ac46a55527ac41400000000000000000000000000000000000000026a56527ac401016a57527ac46a00c3653305756a53c3034f4e479c646d006a00c36a51c36a52c353c66b6a52527ac46a51527ac46a00527ac46c6a58527ac4006a56c3087472616e736665726a58c351c176c9537951795572755172755279527954727552727568164f6e746f6c6f67792e4e61746976652e496e766f6b65616a57527ac4628a00616a53c304534f4e549c643700087472616e736665726a00c36a51c36a52c353c176c97c677dd2f7853d8ce3f9e9226c4a21ee09f9eb1ea0966a57527ac4624900616a53c304444943459c643700087472616e736665726a00c36a51c36a52c353c176c97c67bc28b0f6541650b30d36144d077e5e77a46eb29b6a57527ac46208006165dcea75616a54c36a55c36a00c36a51c36a53c36a52c36a57c357c176c9681553797374656d2e52756e74696d652e4e6f74696679616a57c301019c640700516c756661006c7566006c756659c56b6a00527ac46a51527ac4682d53797374656d2e457865637574696f6e456e67696e652e476574457865637574696e6753637269707448617368616a52527ac4087472616e736665726a52c36a00c36a51c353c176c97c67bc28b0f6541650b30d36144d077e5e77a46eb29b6a53527ac46a53c301019c640700516c756661006c7566006c75665ac56b6a00527ac46a51527ac4682d53797374656d2e457865637574696f6e456e67696e652e476574457865637574696e6753637269707448617368616a52527ac46a00c3651d0375087472616e736665726a00c36a52c36a51c353c176c97c67bc28b0f6541650b30d36144d077e5e77a46eb29b6a53527ac46a53c301019c640700516c756661006c7566006c756659c56b6a00527ac46a51527ac4682d53797374656d2e457865637574696f6e456e67696e652e476574457865637574696e6753637269707448617368616a52527ac4087472616e736665726a52c36a00c36a51c353c176c97c677dd2f7853d8ce3f9e9226c4a21ee09f9eb1ea0966a53527ac46a53c301019c640700516c756661006c7566006c75665ac56b6a00527ac46a51527ac4682d53797374656d2e457865637574696f6e456e67696e652e476574457865637574696e6753637269707448617368616a52527ac46a00c365040275087472616e736665726a00c36a52c36a51c353c176c97c677dd2f7853d8ce3f9e9226c4a21ee09f9eb1ea0966a53527ac46a53c301019c640700516c756661006c7566006c75665bc56b6a00527ac46a51527ac41400000000000000000000000000000000000000026a52527ac4682d53797374656d2e457865637574696f6e456e67696e652e476574457865637574696e6753637269707448617368616a53527ac46a53c36a00c36a51c353c66b6a52527ac46a51527ac46a00527ac46c6a54527ac4006a52c3087472616e736665726a54c351c176c9537951795572755172755279527954727552727568164f6e746f6c6f67792e4e61746976652e496e766f6b65616a55527ac46a55c301019c640700516c756661006c7566006c75665cc56b6a00527ac46a51527ac41400000000000000000000000000000000000000026a52527ac4682d53797374656d2e457865637574696f6e456e67696e652e476574457865637574696e6753637269707448617368616a53527ac46a00c3658100756a00c36a53c36a51c353c66b6a52527ac46a51527ac46a00527ac46c6a54527ac4006a52c3087472616e736665726a54c351c176c9537951795572755172755279527954727552727568164f6e746f6c6f67792e4e61746976652e496e766f6b65616a55527ac46a55c301019c640700516c756661006c7566006c756654c56b6a00527ac46a00c3681b53797374656d2e52756e74696d652e436865636b5769746e657373616563e675006c756654c56b6a00527ac46a00c3c001149c654ce675006c75665ec56b6a00527ac46a51527ac46a51c36a00c3946a52527ac46a52c3c56a53527ac4006a54527ac46a00c36a55527ac461616a00c36a51c39f6433006a54c36a55c3936a56527ac46a56c36a53c36a54c37bc46a54c351936a54527ac46a55c36a54c3936a00527ac462c8ff6161616a53c36c7566";
        int index = code.lastIndexOf("67");
        if(index >0){
            String str = code.substring(index+2);
            if(str.length() >= 40){
                calledContractHash = str.substring(0, 40);
            }
        }
        System.out.println("called:"+Helper.reverse(calledContractHash));

    }

}
